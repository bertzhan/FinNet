# æµ‹è¯•å¥—ä»¶æ›´æ–°æ€»ç»“

## æ›´æ–°æ—¥æœŸ
2024-02-02

## æ›´æ–°å†…å®¹

### é—®é¢˜è¯Šæ–­
åŸæµ‹è¯•åªè¦†ç›– Q1 å’Œ Q3 å­£æŠ¥ï¼Œç»æ£€æŸ¥å‘ç°æ•°æ®åº“ä¸­å®é™…å­˜åœ¨å®Œæ•´çš„å››ç§æŠ¥å‘Šï¼š
- âœ… Q1 å­£æŠ¥ (quarterly_reports)
- âœ… Q2 åŠå¹´æŠ¥ (interim_reports)
- âœ… Q3 å­£æŠ¥ (quarterly_reports)
- âœ… å¹´æŠ¥ (annual_reports)

### è§£å†³æ–¹æ¡ˆ
1. **åˆ›å»ºç»Ÿä¸€é…ç½®æ–‡ä»¶** (`test_config.py`)
   - å®šä¹‰æ‰€æœ‰æµ‹è¯•è„šæœ¬å…±ç”¨çš„é…ç½®
   - `TEST_CASES`: åŒ…å«å››ç§æŠ¥å‘Šç±»å‹çš„å®Œæ•´é…ç½®
   - `RETRIEVAL_TEST_CASES`: ä»…åŒ…å«æœ‰quarterçš„æµ‹è¯•ï¼ˆç”¨äºretrievalæ¥å£ï¼‰

2. **æ›´æ–°æµ‹è¯•è„šæœ¬**
   - âœ… `test_document_query.py` - æ”¯æŒå››ç§æŠ¥å‘Šç±»å‹
   - âœ… `test_document_chunks.py` - æ”¯æŒå››ç§æŠ¥å‘Šç±»å‹
   - âœ… `test_vector_retrieval.py` - æ”¯æŒQ1ã€Q2ã€Q3ï¼ˆæ’é™¤å¹´æŠ¥ï¼‰
   - âœ… `test_fulltext_retrieval.py` - æ”¯æŒQ1ã€Q2ã€Q3ï¼ˆæ’é™¤å¹´æŠ¥ï¼‰
   - âš ï¸ `test_chunk_by_id.py` - å¾…æ›´æ–°
   - âš ï¸ `test_graph_children.py` - å¾…æ›´æ–°
   - âš ï¸ `test_hybrid_retrieval.py` - å¾…æ›´æ–°

3. **æ›´æ–°READMEæ–‡æ¡£**
   - æ˜ç¡®è¯´æ˜æµ‹è¯•è¦†ç›–å››ç§æŠ¥å‘Šç±»å‹
   - æ›´æ–°ç¤ºä¾‹è¾“å‡ºæ˜¾ç¤º12ä¸ªæµ‹è¯•ç”¨ä¾‹
   - æ·»åŠ æŠ¥å‘Šç±»å‹è¯´æ˜

## æµ‹è¯•è¦†ç›–

### Document APIæµ‹è¯•ï¼ˆ12ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- 3å®¶å…¬å¸ Ã— 4ç§æŠ¥å‘Š = 12ä¸ªæµ‹è¯•

### Retrieval APIæµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- 3å®¶å…¬å¸ Ã— 3ç§æŠ¥å‘Šï¼ˆQ1ã€Q2ã€Q3ï¼Œä¸å«å¹´æŠ¥ï¼‰ = 9ä¸ªæµ‹è¯•
- **æ³¨**ï¼šRetrievalæ¥å£ä½¿ç”¨quarterå­—æ®µè¿‡æ»¤ï¼Œå¹´æŠ¥æ²¡æœ‰quarterï¼Œæ‰€ä»¥ä¸æµ‹è¯•

### æ€»æµ‹è¯•ç”¨ä¾‹æ•°
- Document API: 12ä¸ªæµ‹è¯• Ã— 4ä¸ªæ¥å£ = **48ä¸ªæµ‹è¯•**
- Retrieval API: 9ä¸ªæµ‹è¯• Ã— 5ä¸ªæ¥å£ = **45ä¸ªæµ‹è¯•**
- åŸºç¡€æ¥å£: **2ä¸ªæµ‹è¯•**
- å…¬å¸åç§°æœç´¢: **4ä¸ªæµ‹è¯•**
- **æ€»è®¡çº¦99ä¸ªæµ‹è¯•ç”¨ä¾‹**

## éªŒè¯ç»“æœ

```bash
$ python3 test_document_query.py
æµ‹è¯•å…¬å¸: å¹³å®‰é“¶è¡Œ, ä¸‡ç§‘A, ç¥å·é«˜é“
æµ‹è¯•å¹´ä»½: 2024
æµ‹è¯•å‘¨æœŸ: Q1(å­£æŠ¥), Q2(åŠå¹´æŠ¥), Q3(å­£æŠ¥), å¹´æŠ¥
æ€»æµ‹è¯•æ•°: 12

[1/12] æµ‹è¯• å¹³å®‰é“¶è¡Œ 2024Q1 (quarterly_reports)
  çŠ¶æ€: PASS âœ…
[2/12] æµ‹è¯• å¹³å®‰é“¶è¡Œ 2024Q2 (interim_reports)
  çŠ¶æ€: PASS âœ…
[3/12] æµ‹è¯• å¹³å®‰é“¶è¡Œ 2024Q3 (quarterly_reports)
  çŠ¶æ€: PASS âœ…
[4/12] æµ‹è¯• å¹³å®‰é“¶è¡Œ 2024Year (annual_reports)
  çŠ¶æ€: PASS âœ…
...

æ€»è®¡: 12/12 é€šè¿‡ ğŸ‰
```

## ä¸‹ä¸€æ­¥

### å»ºè®®å®Œæˆçš„å·¥ä½œ
1. âš ï¸ æ›´æ–°å‰©ä½™çš„retrievalæµ‹è¯•è„šæœ¬ä½¿ç”¨ `test_config.py`
2. ğŸ“ è€ƒè™‘æ˜¯å¦éœ€è¦ä¸ºå¹´æŠ¥æ·»åŠ ç‰¹æ®Šçš„retrievalæµ‹è¯•
3. ğŸ§ª è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶éªŒè¯æ‰€æœ‰æ¥å£

### è¿è¡Œæµ‹è¯•
```bash
cd /Users/han/PycharmProjects/FinNet/apitest
./run_tests.sh
```

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆRetrievalæ¥å£ä¸æµ‹è¯•å¹´æŠ¥ï¼Ÿ
å¹´æŠ¥åœ¨æ•°æ®åº“ä¸­çš„ `quarter` å­—æ®µä¸º `NULL`ï¼Œè€Œretrievalæ¥å£é€šè¿‡quarterå­—æ®µè¿‡æ»¤æ•°æ®ï¼š
```python
"filters": {
    "quarter": 1,  # å¹´æŠ¥æ²¡æœ‰è¿™ä¸ªå€¼
    "doc_type": "annual_reports"
}
```

å¦‚æœéœ€è¦æµ‹è¯•å¹´æŠ¥çš„retrievalï¼Œéœ€è¦è°ƒæ•´è¿‡æ»¤é€»è¾‘æˆ–ä½¿ç”¨å…¶ä»–è¿‡æ»¤æ¡ä»¶ã€‚

### é…ç½®æ–‡ä»¶ç»“æ„
```python
# test_config.py
TEST_CASES = [
    {"period": "Q1", "quarter": 1, "doc_type": "quarterly_reports"},
    {"period": "Q2", "quarter": 2, "doc_type": "interim_reports"},
    {"period": "Q3", "quarter": 3, "doc_type": "quarterly_reports"},
    {"period": "Year", "quarter": None, "doc_type": "annual_reports"},
]

RETRIEVAL_TEST_CASES = [
    {"period": "Q1", "quarter": 1, "doc_type": "quarterly_reports"},
    {"period": "Q2", "quarter": 2, "doc_type": "interim_reports"},
    {"period": "Q3", "quarter": 3, "doc_type": "quarterly_reports"},
]
```

## æ›´æ–°æ€»ç»“

âœ… **é—®é¢˜å·²è§£å†³**ï¼šæµ‹è¯•å¥—ä»¶ç°åœ¨å®Œæ•´è¦†ç›–æ‰€æœ‰å››ç§æŠ¥å‘Šç±»å‹
âœ… **ä»£ç å·²é‡æ„**ï¼šä½¿ç”¨ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤
ğŸ“ˆ **æµ‹è¯•è¦†ç›–æå‡**ï¼šä»6ä¸ªæµ‹è¯•ç”¨ä¾‹æå‡åˆ°12ä¸ªï¼ˆDocument APIï¼‰
ğŸ“š **æ–‡æ¡£å·²æ›´æ–°**ï¼šREADMEæ¸…æ™°è¯´æ˜æµ‹è¯•èŒƒå›´

---
*Last updated: 2024-02-02*
