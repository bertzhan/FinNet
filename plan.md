# 全球上市公司公开数据湖架构设计方案

## 一、项目概述

### 1.1 目标定位

构建一个面向大模型训练和知识库应用的数据湖平台，整合 **A股、港股、美股** 上市公司**监管披露数据**，提供高质量的结构化与非结构化数据支持。

### 1.2 核心价值

| 应用场景 | 价值描述 |
|---------|---------|
| 大模型预训练语料 | 提供高质量、领域专业的多语言金融文本语料 |
| 大模型 SFT 数据 | 提供标注好的问答对、摘要、分类等指令微调数据 |
| 大模型 RLHF 数据 | 提供人类偏好标注数据，用于奖励模型训练和强化学习 |
| RAG 知识库 | 支持检索增强生成，提供全球上市公司实时、准确的企业信息 |
| 智能问答 | 基于全球企业数据的专业问答系统 |
| 数据标注系统 | 支持 SFT/RLHF 数据标注、审核、管理的一体化平台 |

### 1.3 设计原则

- **私有化部署**：全部组件支持本地化部署，数据不出网
- **国产化优先**：核心组件优先选择国产开源方案
- **开源开放**：采用 Apache 2.0 等宽松协议的开源软件
- **弹性伸缩**：按需启动计算资源，避免浪费
- **多语言支持**：支持中文、英文金融文档处理

### 1.4 数据规模

| 指标 | 规模 |
|-----|------|
| 覆盖市场 | A股、港股、美股 |
| 上市公司数量 | ~14,000+ |
| 数据范围 | 监管披露数据（年报、季报、公告、招股书等） |
| 存量数据 | 约 1-2 TB（历史监管文件） |
| 日增量 | 约 50-100 MB（新增公告和报告） |
| 年增量 | 约 50-100 GB |

---

## 二、数据源规划

### 2.1 市场覆盖范围

| 市场 | 覆盖交易所 | 上市公司数量 | 主要语言 |
|-----|-----------|-------------|---------|
| A股 | 上交所、深交所、北交所 | ~5,000+ | 中文 |
| 港股 | 香港联交所 | ~2,600+ | 中文/英文 |
| 美股 | NYSE、NASDAQ | ~6,000+（含中概股） | 英文 |

### 2.2 核心数据源矩阵

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        上市公司监管披露数据源                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                            A 股市场                                  │   │
│  │                        监管披露数据                                   │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ • 年报/半年报                                                         │   │
│  │ • 季度报告                                                           │   │
│  │ • 招股说明书                                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                            港股市场                                  │   │
│  │                        监管披露数据                                   │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ • 年报/中期报告                                                       │   │
│  │ • 季度披露                                                           │   │
│  │ • 招股章程                                                           │   │
│  │ • 财报电话会                                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                            美股市场                                  │   │
│  │                        监管披露数据                                   │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ • 10-K/10-Q（年报/季报）                                             │   │
│  │ • S-1/F-1招股书（IPO文件）                                           │   │
│  │ • 财报电话会                                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 各市场数据源详细说明

#### 2.3.1 A股数据源

| 数据类型 | 数据来源 | 更新频率 | 数据格式 |
|---------|---------|---------|---------|
| 定期报告 | 巨潮资讯、上交所、深交所、北交所 | 季度/年度 | PDF、HTML |
| 招股说明书 | 证监会、交易所 | 事件驱动 | PDF |

#### 2.3.2 港股数据源

| 数据类型 | 数据来源 | 更新频率 | 数据格式 |
|---------|---------|---------|---------|
| 定期报告 | 港交所披露易（HKEX News） | 半年/年度 | PDF |
| 招股章程 | 港交所披露易 | 事件驱动 | PDF |
| 财报电话会 | 公司官网、财经媒体 | 季度 | 音频、文字稿 |

#### 2.3.3 美股数据源

| 数据类型 | 数据来源 | 更新频率 | 数据格式 |
|---------|---------|---------|---------|
| 10-K/10-Q | SEC EDGAR | 季度/年度 | HTML、XML |
| 8-K 公告 | SEC EDGAR | 实时 | HTML、XML |
| 招股书(S-1/F-1) | SEC EDGAR | 事件驱动 | HTML |
| 财报电话会 | 公司官网、Seeking Alpha、财经媒体 | 季度 | 音频、文字稿 |
| 财务数据 | 财报（从10-K/10-Q中提取） | 季度/年度 | 结构化数据 |

### 2.4 数据源特殊说明

#### 2.4.1 多语言处理

| 市场 | 语言 | 处理策略 |
|-----|------|---------|
| A股 | 中文 | 直接处理 |
| 港股 | 中文/英文双语 | 优先中文，英文补充 |
| 美股 | 英文 | 英文处理，关键信息可翻译 |
| 中概股 | 英文（SEC）+ 中文（可选） | 双语对照 |

#### 2.4.2 披露制度差异

| 市场 | 定期报告 | 临时公告 | 特殊披露 |
|-----|---------|---------|---------|
| A股 | 季报+半年报+年报 | 实时 | 招股说明书 |
| 港股 | 中期报告+年报（季报可选） | 实时 | 招股章程、通函 |
| 美股 | 10-Q(季)+10-K(年) | 8-K实时 | Form 4内部人交易、Proxy文件 |

#### 2.4.3 中概股特殊处理

| 数据类型 | 来源 | 说明 |
|---------|------|-----|
| SEC 披露 | EDGAR | 英文，标准美股格式 |
| 公司公告 | 公司官网 | 可能有中文版本，作为补充 |

---

## 三、系统架构设计

### 3.1 整体架构图

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              应用层 (Application Layer)                       │
├────────────────┬────────────────┬────────────────┬───────────────────────────┤
│  LLM 预训练    │  LLM SFT/RLHF │  RAG 知识库    │      数据标注系统          │
│  语料输出      │  数据集输出    │  智能问答      │      标注管理              │
└───────┬────────┴───────┬────────┴───────┬────────┴───────────┬───────────────┘
        │                │                │                    │
┌───────▼────────────────▼────────────────▼────────────────────▼───────────────┐
│                            数据服务层 (Data Service Layer)                    │
├──────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 数据目录    │  │ 数据血缘    │  │ 质量监控    │  │ 权限管理            │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ API Gateway │  │ 查询引擎    │  │ 向量服务    │  │ 数据订阅            │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└───────────────────────────────────────┬──────────────────────────────────────┘
                                        │
┌───────────────────────────────────────▼──────────────────────────────────────┐
│                            数据处理层 (Processing Layer)                      │
├──────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────────────────┐    │
│  │                        数据处理引擎                                   │    │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐                     │    │
│  │  │ Spark      │  │ DuckDB     │  │ Dagster    │                     │    │
│  │  │ 大批量处理 │  │ 日常轻量   │  │ 调度+质量  │                     │    │
│  │  │ (按需启动) │  │ 任务处理   │  │ 感知       │                     │    │
│  │  └────────────┘  └────────────┘  └────────────┘                     │    │
│  └──────────────────────────────────────────────────────────────────────┘    │
│  ┌──────────────────────────────────────────────────────────────────────┐    │
│  │                        AI 处理引擎                                    │    │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐     │    │
│  │  │ MinerU     │  │ PaddleOCR  │  │ 本地LLM    │  │ 向量化     │     │    │
│  │  │ Docling    │  │ OCR识别    │  │ Qwen/GLM   │  │ BGE/BCE    │     │    │
│  │  │ PDF解析    │  │ (国产)     │  │ DeepSeek   │  │ Embedding  │     │    │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘     │    │
│  └──────────────────────────────────────────────────────────────────────┘    │
└───────────────────────────────────────┬──────────────────────────────────────┘
                                        │
┌───────────────────────────────────────▼──────────────────────────────────────┐
│                             数据存储层 (Storage Layer)                        │
├──────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐   │
│  │   原始数据层    │  │   加工数据层    │  │      应用数据层              │   │
│  │   (Bronze)      │  │   (Silver)      │  │      (Gold)                 │   │
│  │                 │  │                 │  │                             │   │
│  │ • 原始PDF/HTML  │  │ • 清洗后文本    │  │ • 训练数据集                │   │
│  │ • 原始API响应   │  │ • 结构化表格    │  │ • 向量索引                  │   │
│  │ • 爬虫快照      │  │ • 实体关系图谱  │  │ • 知识图谱                  │   │
│  │                 │  │ • 标准化指标    │  │ • 标注语料                  │   │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐     │
│  │                         存储引擎                                     │     │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────────┐│     │
│  │  │ MinIO    │ │ Iceberg  │ │PostgreSQL│ │ Milvus   │ │NebulaGraph ││     │
│  │  │ 对象存储 │ │ 湖仓格式 │ │ 元数据   │ │ 向量库   │ │ 图数据库   ││     │
│  │  │          │ │          │ │          │ │ (国产)   │ │ (国产)     ││     │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └────────────┘│     │
│  └─────────────────────────────────────────────────────────────────────┘     │
└───────────────────────────────────────┬──────────────────────────────────────┘
                                        │
┌───────────────────────────────────────▼──────────────────────────────────────┐
│                            数据采集层 (Ingestion Layer)                       │
├──────────────────────────────────────────────────────────────────────────────┤
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────────────────┐  │
│  │ Scrapy     │  │ API        │  │ Kafka      │  │ File Watcher           │  │
│  │ 网页爬虫   │  │ 数据接口   │  │ 消息队列   │  │ 文件监听               │  │
│  └────────────┘  └────────────┘  └────────────┘  └────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 技术选型清单

| 组件 | 选型方案 | 国产 | 选型理由 |
|-----|---------|------|---------|
| 对象存储 | MinIO | - | S3 兼容、私有化部署、成熟稳定 |
| 湖仓格式 | Apache Iceberg | - | 引擎无关、Schema 演进、时间旅行 |
| 批处理 | Spark on K8s + DuckDB | - | 大任务按需启动 + 日常轻量处理 |
| 任务调度 | Dagster | - | 数据质量感知、现代化、Python 原生 |
| 向量数据库 | Milvus | ✓ | 国产、高性能、分布式、生产级成熟 |
| 图数据库 | NebulaGraph | ✓ | 国产、完全开源(Apache 2.0)、分布式 |
| PDF 解析 | MinerU + Docling | ✓ MinerU | 双引擎互补、中文优化好 |
| OCR | PaddleOCR | ✓ | 国产、中文识别优秀 |
| Embedding | BGE/BCE (待测试) | ✓ | 国产、本地部署、中文效果好 |
| LLM | Qwen/GLM/DeepSeek + 云端 API | ✓ | 本地部署为主、云端 API 补充 |
| 消息队列 | Apache Kafka | - | 高吞吐、持久化 |

---

## 四、核心技术决策说明

### 4.1 存储层决策

#### 4.1.1 对象存储：MinIO

**选型理由：**
- S3 API 100% 兼容，整个数据湖生态（Iceberg、Spark、Milvus）都支持
- 私有化部署，数据不出网
- 成熟稳定，运维简单

**部署建议：**

| 配置项 | 推荐值 |
|-------|--------|
| 节点数 | 单机起步，后期按需扩展 |
| 单节点配置 | 8核 CPU、32GB 内存 |
| 数据盘 | 2-4 × 4TB SSD |
| 网络 | 千兆/万兆网卡 |
| 可用容量 | 8-16TB（满足几TB存量 + 未来增长） |

#### 4.1.2 湖仓格式：Apache Iceberg

**选型理由：**
- 引擎无关：Spark、Trino、Flink、Python 都能读写
- Schema 演进：公告数据字段经常变化，可安全加列、改类型
- 时间旅行：支持数据版本回溯，便于审计
- 分区演进：可无缝调整分区策略，无需重写数据

#### 4.1.3 向量数据库：Milvus

**选型理由：**
- 国产开源（Zilliz），Apache 2.0 协议
- 生产级成熟，支持十亿级向量
- 单机版即可支撑千万级向量，后期可扩展为分布式
- 支持混合检索（向量 + 标量过滤）

**预估数据量：**

| 数据类型 | 估算向量数 |
|---------|-----------|
| 年报/定期报告 | ~500 万 |
| 公告 | ~200 万 |
| 研报 | ~300 万 |
| 新闻 | ~500 万 |
| **总计** | **约 1500 万向量** |

#### 4.1.4 图数据库：NebulaGraph

**选型理由：**
- 国产开源，Apache 2.0 协议（完全免费）
- 原生分布式，可水平扩展
- 兼容 openCypher 语法，迁移成本低
- 生产案例多：美团、京东、微众银行等

**对比 Neo4j：**

| 维度 | Neo4j | NebulaGraph |
|-----|-------|-------------|
| 开源协议 | GPL v3（社区版功能受限） | Apache 2.0（完全开源） |
| 分布式 | 企业版才支持 | 原生支持 |
| 成本 | 企业版昂贵 | 免费 |

### 4.2 计算层决策

#### 4.2.1 批处理：Spark on K8s + DuckDB

**设计思路：**

基于数据规模（日增约 50-100 MB），采用混合方案：

| 任务类型 | 数据量 | 推荐引擎 |
|---------|-------|---------|
| 日常公告处理 | 50-100 MB/天 | DuckDB + Python |
| PDF 解析入库 | 单文件 | Python 脚本 |
| 财务指标计算 | 几 GB | DuckDB / Polars |
| 向量化处理 | 几 GB | Python + 批处理 |
| 全量历史重跑 | 1-2 TB | Spark on K8s（临时启动，可选） |

**Spark 使用策略：**
- 不常驻，按需启动
- 通过 K8s Job 动态申请资源
- 任务完成后自动释放
- 避免资源闲置浪费

#### 4.2.2 任务调度：Dagster

**选型理由：**

相比 Airflow，Dagster 具备数据质量感知能力：

| 能力 | Airflow | Dagster |
|-----|---------|---------|
| 任务执行状态 | ✓ | ✓ |
| 数据质量检查 | 需额外开发 | 内置支持 |
| 数据血缘 | 弱 | 强 |
| 本地测试 | 困难 | 简单 |

**数据质量检查示例：**
- 数据不为空检查
- 数据量波动检查（与历史对比）
- 字段完整性检查
- 数值范围校验

### 4.3 AI 处理层决策

#### 4.3.1 PDF 解析：MinerU + Docling 双引擎

**设计思路：**

| 引擎 | 优势 | 适用场景 |
|-----|------|---------|
| MinerU（上海AI Lab） | 中文优化好、复杂表格强 | 中文年报、公告 |
| Docling（IBM） | 多格式支持、结构化输出好 | 英文研报、批量流水线 |

**使用策略：**

```
阶段一（冷启动）：
├── 两个引擎都跑
├── 结果都存到 Bronze 层
├── 人工抽检，统计各自准确率
└── 确定各自擅长的场景

阶段二（生产运行）：
├── 根据文档类型路由到对应引擎
├── 解析失败时互为 fallback
└── 定期抽检质量
```

#### 4.3.2 LLM：本地部署 + 云端 API 混合

**设计思路：**

| 使用场景 | 推荐方案 | 理由 |
|---------|---------|-----|
| 大批量标注 | 本地 LLM | 成本低 |
| 敏感数据处理 | 本地 LLM | 数据不出网 |
| 日常 RAG 问答 | 本地 LLM | 延迟低 |
| 复杂任务 | 云端 API | 能力更强 |
| 效果对比测试 | 云端 API | 作为基准 |

**本地 LLM 候选：**
- Qwen2.5（阿里，国产）
- GLM-4（智谱，国产）
- DeepSeek（国产）

**部署方式：**
- 使用 vLLM 部署，提供 OpenAI 兼容接口
- 7B 模型需 16GB+ 显存（A10/RTX4090）
- 14B+ 模型需 40GB+ 显存（A100）

#### 4.3.3 Embedding：待测试确定

**候选模型：**

| 模型 | 维度 | 来源 | 特点 |
|-----|-----|------|-----|
| BGE-large-zh-v1.5 | 1024 | 智源（国产） | 中文 SOTA |
| BCE-embedding-base | 768 | 网易有道（国产） | 轻量高效 |
| text2vec-large-chinese | 1024 | 国产 | 成熟稳定 |

**评估方式：**
- 金融问答检索任务
- 公告相似度任务
- 研报分类任务
- 根据测试结果选择最佳模型

---

## 五、数据分层设计

### 5.1 湖仓分层模型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                数据分层架构                                  │
├───────────────┬───────────────┬───────────────┬─────────────────────────────┤
│   Bronze      │    Silver     │     Gold      │      Application            │
│   原始层      │    清洗层     │    聚合层     │      应用层                 │
├───────────────┼───────────────┼───────────────┼─────────────────────────────┤
│ • 原始PDF     │ • 解析文本    │ • 财务指标    │ • 预训练语料                │
│ • HTML快照    │ • 清洗表格    │ • 公司画像    │ • SFT数据集                 │
│ • API响应     │ • 实体标注    │ • 知识图谱    │ • RLHF偏好数据              │
│ • 原始JSON    │ • 去重数据    │ • 时序指标    │ • 向量索引                  │
│               │               │ • 跨市场映射  │ • RAG文档库                 │
├───────────────┼───────────────┼───────────────┼─────────────────────────────┤
│ 保留原貌      │ 标准化清洗    │ 业务建模      │ AI应用就绪                  │
│ 支持回溯      │ 质量保证      │ 指标计算      │ 即取即用                    │
└───────────────┴───────────────┴───────────────┴─────────────────────────────┘
                        │
                        │ 验证失败
                        ▼
              ┌─────────────────┐
              │   Quarantine    │
              │     隔离区      │
              ├─────────────────┤
              │ • 采集失败数据  │
              │ • 验证失败数据  │
              │ • 待人工处理    │
              └─────────────────┘
```

### 5.2 存储路径规范

```
s3://company-datalake/
├── bronze/                              # 原始数据层
│   ├── a_share/                         # A股市场
│   │   ├── announcements/               # 公告原文
│   │   │   └── year=YYYY/month=MM/stock_code=XXXXXX/
│   │   ├── annual_reports/              # 年报
│   │   ├── quarterly_reports/           # 季报
│   │   ├── interim_reports/             # 半年报
│   │   └── ipo_prospectus/              # 招股说明书
│   │
│   ├── hk_stock/                        # 港股市场
│   │   ├── announcements/               # 公告/通函
│   │   ├── annual_reports/              # 年报
│   │   ├── interim_reports/             # 中期报告
│   │   ├── quarterly_reports/           # 季度披露（可选）
│   │   ├── ipo_prospectus/              # 招股章程
│   │   └── earnings_calls/              # 财报电话会
│   │
│   ├── us_stock/                        # 美股市场
│   │   ├── sec_filings/                 # SEC披露文件
│   │   │   ├── 10k/                     # 年报
│   │   │   ├── 10q/                     # 季报
│   │   │   ├── 8k/                      # 临时公告
│   │   │   ├── form4/                   # 内部人交易
│   │   │   ├── s1_f1/                   # 招股书
│   │   │   └── proxy/                    # 代理声明
│   │   └── earnings_calls/              # 财报电话会
│
├── quarantine/                          # 隔离区（验证失败数据）
│   ├── ingestion_failed/                # 采集阶段失败
│   ├── validation_failed/               # 入湖验证失败
│   └── content_failed/                  # 内容验证失败
│
├── silver/                              # 清洗数据层
│   ├── announcements_parsed/            # 解析后公告（含市场标识）
│   ├── entities/                        # 实体抽取结果
│   └── text_cleaned/                    # 清洗后文本
│
├── gold/                                # 聚合数据层
│   ├── company_profiles/                # 公司画像
│   ├── financial_metrics/               # 财务指标
│   ├── knowledge_graph/                 # 知识图谱
│   └── time_series/                     # 时序指标
│
└── application/                         # AI应用层
    ├── training_corpus/                 # 预训练语料
    │   ├── chinese/                     # 中文语料
    │   └── english/                     # 英文语料
    ├── sft_datasets/                    # SFT微调数据集
    ├── rlhf_datasets/                   # RLHF训练数据集
    │   ├── preference_pairs/            # 偏好对数据
    │   ├── reward_model/                # 奖励模型训练数据
    │   └── safety_labels/               # 安全标注数据
    ├── vector_store/                    # 向量存储快照
    └── rag_documents/                   # RAG文档库
```

---

## 六、数据处理流程

### 6.1 整体处理流程

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   PDF/HTML  │───▶│   文档解析  │───▶│   文本清洗  │───▶│  实体抽取   │
│   原始文件  │    │ MinerU/     │    │             │    │             │
│             │    │ Docling     │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                         │                  │                  │
                         ▼                  ▼                  ▼
                   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
                   │ 表格提取    │    │ 分词/分句   │    │ 关系抽取    │
                   │ 图表识别    │    │ 去噪/归一化 │    │ 事件抽取    │
                   └─────────────┘    └─────────────┘    └─────────────┘
                         │                  │                  │
                         └──────────────────┼──────────────────┘
                                            │
                                            ▼
                                   ┌─────────────────┐
                                   │   质量检验      │
                                   │  Dagster 内置   │
                                   └────────┬────────┘
                                            │
              ┌─────────────────────────────┼─────────────────────────────┐
              │                             │                             │
              ▼                             ▼                             ▼
     ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
     │  结构化存储     │          │  向量化存储     │          │  图谱存储       │
     │  (Iceberg)      │          │  (Milvus)       │          │  (NebulaGraph)  │
     └─────────────────┘          └─────────────────┘          └─────────────────┘
```

### 6.2 数据采集流程

```
┌─────────────────────────────────────────────────────────────────┐
│                       采集调度中心                               │
│                       (Dagster)                                 │
└──────────────────────────┬──────────────────────────────────────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐
│   定时爬虫任务   │ │   API 轮询任务   │ │   文件监听任务   │
│                  │ │                  │ │                  │
│ • 公告爬取       │ │ • SEC EDGAR API  │ │ • 手动上传处理   │
│ • 定期报告下载   │ │ • 港交所API     │ │ • 批量导入       │
│ • 招股书采集     │ │ • 交易所API     │ │                  │
└────────┬─────────┘ └────────┬─────────┘ └────────┬─────────┘
         │                    │                    │
         └────────────────────┼────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │   消息队列        │
                    │   (Kafka)        │
                    └────────┬─────────┘
                             │
                             ▼
                    ┌──────────────────┐
                    │  原始数据落地    │
                    │  (Bronze Layer)  │
                    └──────────────────┘
```

### 6.3 增量采集策略

| 数据类型 | 增量策略 | 实现方式 |
|---------|---------|---------|
| 公告文件 | 时间戳水位线 | 记录最后采集时间，只拉取新增 |
| 定期报告 | 报告期标识 | 按年度+季度唯一标识，避免重复 |
| SEC文件 | 文件ID | 基于SEC Accession Number去重 |
| 招股书 | 事件驱动 | 基于IPO事件触发采集 |
| 财报电话会 | 报告期+日期 | 按季度报告期+电话会日期唯一标识 |

---

## 七、数据验证体系

### 7.1 全链路验证架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            全链路数据验证架构                                │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   数据采集   │───▶│   入湖验证   │───▶│   内容验证   │───▶│   质量监控   │
│   阶段验证   │    │  (Bronze前)  │    │  (Silver前)  │    │   (持续)     │
└──────┬───────┘    └──────┬───────┘    └──────┬───────┘    └──────┬───────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ • 来源可信度 │    │ • 文件完整性 │    │ • 编码正确性 │    │ • 数据量监控 │
│ • 响应完整性 │    │ • 格式验证   │    │ • 语言匹配   │    │ • 异常检测   │
│ • 格式正确性 │    │ • 元数据完整 │    │ • 内容非空   │    │ • 趋势分析   │
│ • 时效性     │    │ • 去重检查   │    │ • 字段校验   │    │ • 告警通知   │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
       │                   │                   │                   │
       └───────────────────┴───────────────────┴───────────────────┘
                                    │
                                    ▼ 验证失败
                           ┌──────────────────┐
                           │     隔离区       │
                           │  人工处理队列    │
                           └──────────────────┘
```

### 7.2 采集阶段验证

| 验证点 | 验证内容 | 失败处理 |
|-------|---------|---------|
| 来源可信度 | 数据来自官方渠道（巨潮、交易所、SEC） | 拒绝，记录告警 |
| 响应完整性 | HTTP 状态码正常、无截断、无超时 | 重试3次后隔离 |
| 格式正确性 | PDF可识别、JSON/XML结构合法 | 隔离，人工检查 |
| 时效性 | 数据发布时间在合理范围内 | 隔离，人工确认 |
| 反爬检测 | 非验证码页面、非封禁响应 | 暂停采集，告警 |

### 7.3 入湖前验证（Bronze 层）

| 验证类型 | 验证规则 | 失败处理 |
|---------|---------|---------|
| 文件完整性 | 文件大小 > 0，MD5/SHA256 校验通过 | 隔离 |
| 格式验证 | PDF 可解析、JSON Schema 校验通过 | 隔离 |
| 元数据完整 | 股票代码、发布日期、文档类型必填 | 隔离 |
| 去重检查 | 同一公告（相同代码+日期+标题）不重复 | 跳过，记录日志 |
| 时间合理性 | 发布日期不在未来、不超过合理历史范围 | 隔离 |
| 文件大小 | 在合理范围内（如 PDF < 500MB） | 隔离 |

### 7.4 内容验证（Silver 层前）

| 验证类型 | 验证规则 | 失败处理 |
|---------|---------|---------|
| 编码正确 | UTF-8 编码、乱码率 < 1% | 隔离 |
| 语言匹配 | A股文档中文占比 > 80%，美股英文占比 > 80% | 隔离 |
| 内容非空 | 解析后文本长度 > 100 字符 | 隔离 |
| 关键字段 | 公司名称、报告期等核心字段可提取 | 隔离 |
| 数值合理性 | 财务数据在合理范围、无明显异常 | 标记待审核 |

### 7.5 持续质量监控

| 监控项 | 监控规则 | 告警条件 |
|-------|---------|---------|
| 数据量监控 | 每日入库量统计 | 较历史均值偏差 > 50% |
| 隔离区监控 | 隔离数据堆积量 | 待处理 > 100 条 |
| 来源监控 | 各数据源采集成功率 | 成功率 < 90% |
| 延迟监控 | 数据采集到入库延迟 | 延迟 > 2 小时 |
| 质量分监控 | 各类数据质量评分 | 评分 < 0.9 |

### 7.6 隔离区管理

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              隔离区处理流程                                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  验证失败    │───▶│  进入隔离区  │───▶│  人工审核    │───▶│  处理决策    │
│              │    │  记录原因    │    │              │    │              │
└──────────────┘    └──────────────┘    └──────────────┘    └──────┬───────┘
                                                                   │
                         ┌─────────────────────────────────────────┼─────────┐
                         │                    │                    │         │
                         ▼                    ▼                    ▼         ▼
                  ┌────────────┐       ┌────────────┐       ┌────────────┐  ┌────────┐
                  │  修复后    │       │  重新采集  │       │  永久丢弃  │  │ 规则   │
                  │  重新入库  │       │            │       │  记录原因  │  │ 优化   │
                  └────────────┘       └────────────┘       └────────────┘  └────────┘
```

#### 隔离区数据结构

| 字段 | 说明 |
|-----|------|
| quarantine_id | 隔离记录ID |
| source_type | 数据来源（A股/港股/美股） |
| doc_type | 文档类型 |
| original_path | 原始文件路径 |
| failure_stage | 失败阶段（采集/入湖/内容验证） |
| failure_reason | 失败原因 |
| failure_details | 详细错误信息 |
| quarantine_time | 进入隔离时间 |
| status | 状态（待处理/处理中/已解决/已丢弃） |
| handler | 处理人 |
| resolution | 处理结果 |
| resolution_time | 处理时间 |

### 7.7 验证规则配置化

| 配置项 | 说明 | 示例 |
|-------|------|-----|
| 规则启用 | 可单独开关每条规则 | 编码检查: enabled |
| 阈值配置 | 可调整验证阈值 | 最小文件大小: 1KB |
| 市场差异 | 不同市场不同规则 | A股中文占比 > 80% |
| 文档类型差异 | 不同文档类型不同规则 | 年报最小长度 > 10000字 |
| 告警级别 | 不同失败不同级别 | 格式错误: ERROR |

---

## 八、金融本体库与知识图谱

### 7.1 金融本体库设计

#### 7.1.1 本体库层次结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            金融本体库层次结构                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         顶层本体 (Upper Ontology)                    │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│  │  │ 实体     │  │ 事件     │  │ 时间     │  │ 空间     │            │   │
│  │  │ Entity   │  │ Event    │  │ Time     │  │ Location │            │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                       领域本体 (Domain Ontology)                     │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│  │  │ 组织机构 │  │ 金融工具 │  │ 财务会计 │  │ 市场交易 │            │   │
│  │  │ 人物角色 │  │ 行业分类 │  │ 公司治理 │  │ 监管合规 │            │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                       应用本体 (Application Ontology)                │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│  │  │ 财报分析 │  │ 投资研究 │  │ 风险评估 │  │ 舆情分析 │            │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 7.1.2 核心领域本体

| 本体域 | 核心概念 | 说明 |
|-------|---------|------|
| 组织机构 | 上市公司、子公司、股东、监管机构、中介机构 | 市场参与主体 |
| 人物角色 | 董事、监事、高管、实控人、基金经理 | 关键人物及其角色 |
| 金融工具 | 股票、债券、基金、期权、可转债 | 证券品种 |
| 财务会计 | 资产、负债、收入、费用、利润、现金流 | 财务报表要素 |
| 行业分类 | 申万行业、证监会行业、GICS | 行业分类体系 |
| 公司治理 | 股权结构、董事会、股东大会、激励机制 | 治理结构 |
| 市场交易 | 交易所、交易机制、指数、估值 | 市场运行机制 |
| 监管合规 | 信息披露、关联交易、内幕交易、处罚 | 合规要求 |

#### 7.1.3 财务会计本体详细定义

| 一级概念 | 二级概念 | 三级概念示例 |
|---------|---------|-------------|
| 资产 | 流动资产 | 货币资金、应收账款、存货、预付款项 |
| 资产 | 非流动资产 | 固定资产、无形资产、长期投资、商誉 |
| 负债 | 流动负债 | 短期借款、应付账款、预收款项、应付薪酬 |
| 负债 | 非流动负债 | 长期借款、应付债券、长期应付款 |
| 所有者权益 | 股本 | 普通股、优先股 |
| 所有者权益 | 留存收益 | 盈余公积、未分配利润 |
| 收入 | 营业收入 | 主营业务收入、其他业务收入 |
| 费用 | 期间费用 | 销售费用、管理费用、研发费用、财务费用 |
| 利润 | 利润构成 | 营业利润、利润总额、净利润、归母净利润 |

#### 7.1.4 金融事件本体

| 事件类别 | 事件类型 | 关键属性 |
|---------|---------|---------|
| 融资事件 | IPO、增发、配股、发债 | 金额、价格、时间、承销商 |
| 并购事件 | 收购、合并、分立、剥离 | 标的、对价、支付方式、交易进度 |
| 治理事件 | 换届、辞职、任命、激励 | 人物、职位、时间、原因 |
| 分红事件 | 现金分红、送股、转增 | 比例、登记日、除权日 |
| 违规事件 | 处罚、立案、警告、整改 | 违规类型、处罚机构、金额 |
| 业绩事件 | 预增、预减、扭亏、首亏 | 变动幅度、变动原因 |

### 7.2 知识图谱设计

#### 7.2.1 实体类型定义

| 类别 | 实体类型 | 说明 | 属性示例 |
|-----|---------|------|---------|
| 组织 | COMPANY | 上市公司 | 代码、名称、行业、市场、上市日期 |
| 组织 | SUBSIDIARY | 子公司 | 名称、持股比例、注册资本 |
| 组织 | SHAREHOLDER | 股东 | 名称、类型、持股数、持股比例 |
| 组织 | INSTITUTION | 机构 | 名称、类型（券商/基金/银行） |
| 人物 | PERSON | 人物 | 姓名、性别、学历、履历 |
| 人物 | EXECUTIVE | 高管 | 职位、任职日期、薪酬 |
| 金融 | STOCK | 股票 | 代码、简称、市场、板块 |
| 金融 | BOND | 债券 | 代码、票面利率、到期日 |
| 金融 | INDEX | 指数 | 代码、名称、成分股 |
| 财务 | FINANCIAL_METRIC | 财务指标 | 指标名称、计算公式、单位 |
| 财务 | REPORT_PERIOD | 报告期 | 年度、季度、报告类型 |
| 行业 | INDUSTRY | 行业 | 行业代码、行业名称、分类体系 |
| 市场 | MARKET | 交易市场 | 市场代码、名称、交易时间 |
| 事件 | EVENT | 事件 | 事件类型、发生时间、影响 |

#### 7.2.2 关系类型定义

| 关系 | 主体 | 客体 | 属性 |
|-----|------|------|-----|
| LISTED_IN | 公司 | 市场 | 上市日期、股票代码 |
| BELONGS_TO | 公司 | 行业 | 分类体系、是否主业 |
| HOLDS_SHARES | 股东 | 公司 | 持股数、持股比例、持股性质 |
| SUBSIDIARY_OF | 子公司 | 母公司 | 持股比例、控制方式 |
| MANAGES | 高管 | 公司 | 职位、任职起止日期 |
| COMPETES_WITH | 公司 | 公司 | 竞争领域 |
| SUPPLIES_TO | 公司 | 公司 | 供应产品、交易金额 |
| INVESTED_BY | 公司 | 机构 | 持仓市值、持仓比例 |
| DUAL_LISTED | A股公司 | H股公司 | AH溢价 |
| ADR_OF | ADR | 原股 | 兑换比例 |
| TRIGGERS | 事件 | 事件 | 因果关系 |

#### 7.2.3 跨市场映射

| 映射类型 | 说明 | 示例 |
|---------|------|-----|
| A+H 股 | 同时在A股和港股上市 | 中国平安(601318.SH ↔ 2318.HK) |
| 中概股ADR | 美股上市的中国公司 | 阿里巴巴(BABA ↔ 9988.HK) |
| 三地上市 | A+H+美股 | 部分大型公司 |

### 7.3 本体库与知识图谱关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         本体库与知识图谱的关系                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐          ┌─────────────────────┐                 │
│   │     金融本体库       │          │     知识图谱         │                 │
│   │    (Ontology)       │  指导     │  (Knowledge Graph)  │                 │
│   │                     │ ───────▶ │                     │                 │
│   │  • 概念定义         │          │  • 实体实例         │                 │
│   │  • 层次结构         │          │  • 关系实例         │                 │
│   │  • 属性约束         │          │  • 属性值           │                 │
│   │  • 关系规范         │          │  • 事实三元组       │                 │
│   │                     │          │                     │                 │
│   │  Schema 层          │          │  Data 层            │                 │
│   └─────────────────────┘          └─────────────────────┘                 │
│                                                                             │
│   示例：                                                                    │
│   本体定义：COMPANY -[HOLDS_SHARES]-> SHAREHOLDER (持股比例: float)         │
│   图谱实例：平安银行 -[HOLDS_SHARES {ratio: 0.489}]-> 中国平安              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```



---

## 九、数据标注体系

### 8.1 标注任务类型

#### 8.1.1 SFT 标注任务

| 标注类型 | 应用场景 | 标注方式 |
|---------|---------|---------|
| 文本分类 | 公告分类、情感分析 | LLM 初标 + 人工审核 |
| 命名实体识别 | 实体抽取 | LLM 初标 + 人工修正 |
| 关系抽取 | 知识图谱构建 | LLM 初标 + 人工审核 |
| 问答对生成 | SFT 微调数据 | LLM 生成 + 人工筛选 |
| 文本摘要 | 摘要模型训练 | LLM 生成 + 人工评分 |

#### 8.1.2 RLHF 标注任务

| 标注类型 | 应用场景 | 标注方式 |
|---------|---------|---------|
| 回答偏好排序 | 奖励模型训练 | 同一问题多个回答，人工排序优劣 |
| 回答质量评分 | 奖励模型训练 | 对回答的准确性、完整性、专业性评分 |
| 安全性标注 | 安全对齐 | 标注回答是否存在有害/误导内容 |
| 事实性校验 | 减少幻觉 | 标注回答中的事实是否可验证 |
| 对比选择 | 偏好学习 | A/B 回答二选一 |

### 8.2 RLHF 数据格式

#### 8.2.1 偏好排序数据

| 字段 | 说明 |
|-----|------|
| prompt | 用户问题 |
| chosen | 优选回答 |
| rejected | 劣选回答 |
| source | 数据来源 |
| annotator | 标注者 |

#### 8.2.2 评分数据

| 字段 | 说明 |
|-----|------|
| prompt | 用户问题 |
| response | 模型回答 |
| score | 综合评分 (1-5) |
| accuracy | 准确性评分 |
| completeness | 完整性评分 |
| professionalism | 专业性评分 |
| reasoning | 评分理由 |

### 8.3 RLHF 标注场景示例

| 场景 | 问题类型 | 标注重点 |
|-----|---------|---------|
| 财务分析 | "分析XX公司的盈利能力" | 数据准确性、分析深度、逻辑性 |
| 风险提示 | "XX公司有哪些风险" | 全面性、客观性、专业表述 |
| 对比分析 | "A公司和B公司哪个更值得投资" | 平衡性、依据充分性、避免主观 |
| 事件解读 | "如何解读XX公告" | 要点提取、影响分析、专业判断 |

### 8.4 LLM 辅助标注流程

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  原始文档    │───▶│  LLM 初标    │───▶│  置信度筛选  │───▶│  人工审核    │
│              │    │  (本地Qwen)  │    │              │    │              │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
                                               │
                          ┌────────────────────┴────────────────────┐
                          │                                         │
                          ▼                                         ▼
                   ┌──────────────┐                          ┌──────────────┐
                   │  高置信度    │                          │  低置信度    │
                   │  直接入库    │                          │  人工复核    │
                   └──────────────┘                          └──────────────┘
                          │                                         │
                          └─────────────────┬───────────────────────┘
                                            │
                                            ▼
                                   ┌──────────────┐
                                   │  标注数据库  │
                                   └──────────────┘
```

### 8.5 标注质量控制

#### 8.5.1 SFT 标注质量指标

| 指标 | 说明 | 阈值 |
|-----|------|-----|
| 标注一致性 (Kappa) | 多标注者一致性系数 | > 0.8 |
| 准确率 | 与黄金标准对比 | > 0.95 |
| 召回率 | 实体/关系覆盖率 | > 0.90 |
| 返工率 | 需重新标注比例 | < 5% |

#### 8.5.2 RLHF 标注质量指标

| 指标 | 说明 | 阈值 |
|-----|------|-----|
| 偏好一致性 | 多标注者对同一对比较的一致率 | > 80% |
| 评分相关性 | 标注者评分间的相关系数 | > 0.7 |
| 专业性审核 | 金融专家抽检通过率 | > 90% |
| 事实准确性 | 可验证事实的正确率 | > 95% |

---

## 十、大模型数据输出

### 9.1 预训练语料

**格式：** JSONL

**字段说明：**

| 字段 | 说明 |
|-----|------|
| text | 文本内容 |
| meta.source | 数据来源（annual_report/news/research） |
| meta.stock_code | 股票代码 |
| meta.market | 市场（a_share/hk_stock/us_stock） |
| meta.language | 语言（zh/en） |
| meta.date | 发布日期 |

### 9.2 SFT 微调数据

**支持格式：**
- Alpaca 格式（instruction/input/output）
- ShareGPT 格式（conversations）

**数据类型：**

| 任务类型 | 说明 |
|---------|------|
| 财务分析 | 盈利能力、偿债能力分析 |
| 研报解读 | 研报摘要、评级解释 |
| 公告解读 | 关键信息提取、影响分析 |
| 投资问答 | 股票推荐、风险评估 |
| 跨市场对比 | A/H股、中概股对比分析 |

### 9.3 RLHF 训练数据

#### 9.3.1 偏好数据格式

**格式：** JSONL（兼容主流 RLHF 框架）

| 字段 | 说明 |
|-----|------|
| prompt | 用户问题/指令 |
| chosen | 人工选择的优质回答 |
| rejected | 相对较差的回答 |
| chosen_score | 优选回答评分（可选） |
| rejected_score | 劣选回答评分（可选） |
| metadata | 元信息（标注者、时间、类型） |

#### 9.3.2 奖励模型训练数据

| 数据类型 | 说明 | 数量目标 |
|---------|------|---------|
| 偏好对数据 | chosen/rejected 配对 | 10,000+ 对 |
| 评分数据 | 1-5 分制评分 | 20,000+ 条 |
| 安全标注 | 有害/安全二分类 | 5,000+ 条 |

#### 9.3.3 RLHF 数据质量要求

| 质量维度 | 要求 |
|---------|------|
| 标注一致性 | 多标注者一致性 > 80% |
| 金融专业性 | 标注者具备金融背景 |
| 覆盖多样性 | 覆盖各类金融问答场景 |
| 难度分布 | 简单/中等/困难合理分布 |

### 9.4 RAG 知识库

**文档分块策略：**
- 语义分块：按自然段落分割
- 保持表格完整性
- 块大小：512 tokens，重叠 50 tokens

**向量化存储：**
- 存储引擎：Milvus
- 向量维度：1024（以 BGE 为例）
- 支持标量过滤：stock_code、doc_type、publish_date

---

## 十一、数据治理与安全

### 10.1 数据质量监控

**Dagster 内置质量检查：**

| 检查类型 | 说明 |
|---------|------|
| 完整性检查 | 必填字段空值率 < 5% |
| 数量检查 | 数据量波动 < 20% |
| 格式检查 | 字段格式符合规范 |
| 范围检查 | 数值在合理范围内 |

### 10.2 数据血缘

Dagster 自动追踪数据资产间的依赖关系，支持：
- 上下游影响分析
- 数据问题根因定位
- 变更影响评估

### 10.3 安全与合规

| 安全层面 | 措施 |
|---------|-----|
| 访问控制 | RBAC 权限管理 |
| 数据加密 | 静态加密 + 传输加密 |
| 审计日志 | 全链路操作审计 |
| 数据隔离 | 命名空间隔离 |
| 私有化 | 全部组件本地部署，数据不出网 |

---

## 十二、部署架构

### 11.1 Kubernetes 部署架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Kubernetes 集群                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         应用层 Namespace                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │   │
│  │  │ API Gateway │  │ Web Console │  │ Data Service│                 │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         处理层 Namespace                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │   │
│  │  │ Spark       │  │ DuckDB      │  │ Dagster     │                 │   │
│  │  │ (按需启动)  │  │ (常驻轻量) │  │ (调度)      │                 │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          AI 层 Namespace                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │   │
│  │  │ vLLM        │  │ Embedding   │  │ PDF Parse   │                 │   │
│  │  │ (Qwen/GLM)  │  │ Service     │  │ (MinerU)    │                 │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         存储层 Namespace                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────────┐  │   │
│  │  │ MinIO       │  │ PostgreSQL  │  │ Milvus      │  │NebulaGraph│  │   │
│  │  │ (对象存储)  │  │ (元数据)    │  │ (向量)      │  │ (图谱)    │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └───────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 11.2 资源规划

| 组件 | CPU | 内存 | 存储 | GPU | 节点数 |
|-----|-----|------|-----|-----|-------|
| MinIO | 8核 | 32GB | 4TB SSD × 2-4 | - | 1（可扩展） |
| Milvus | 8核 | 32GB | 500GB NVMe | 可选 | 1-2 |
| NebulaGraph | 8核 | 32GB | 500GB SSD | - | 1-3 |
| vLLM (本地LLM) | 16核 | 64GB | 100GB | A100 40G | 1-2 |
| Dagster | 4核 | 16GB | 100GB | - | 1-2 |
| PostgreSQL | 4核 | 16GB | 200GB SSD | - | 1（可主备） |
| Spark Driver | 8核 | 32GB | - | - | 按需 |
| Spark Worker | 16核 | 64GB | 500GB | - | 按需 |

---

## 十三、项目实施路线

### 13.1 阶段规划（40天）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           项目实施甘特图（40天）                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  阶段        │ W1    │ W2    │ W3    │ W4    │ W5    │ W6    │             │
│              │ D1-7  │ D8-14 │ D15-21│ D22-28│ D29-35│ D36-40│             │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────┤             │
│  Phase 1     │████████████████│       │       │       │       │             │
│  基础建设    │  (14天)        │       │       │       │       │             │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────┤             │
│  Phase 2     │       │███████████████████████│       │       │             │
│  能力建设    │       │  (14天)               │       │       │             │
│  ────────────┼───────┼───────┼───────┼───────┼───────┼───────┤             │
│  Phase 3     │       │       │       │███████████████████████│             │
│  应用落地    │       │       │       │  (12天)               │             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**Phase 1: 基础建设（第1-14天）**

| 任务 | 时间 | 交付物 |
|-----|------|-------|
| K8s 集群部署 | D1-3 | 集群就绪 |
| MinIO 存储部署 | D2-4 | 对象存储可用 |
| Dagster 调度部署 | D3-5 | 调度平台就绪 |
| PostgreSQL 部署 | D4-5 | 元数据库就绪 |
| A股数据采集开发 | D5-10 | 公告采集上线 |
| 港股数据采集开发 | D8-12 | 港股采集上线 |
| 美股数据采集开发 | D10-14 | 美股采集上线 |
| PDF解析部署（MinerU+Docling） | D6-10 | 解析服务就绪 |
| 数据验证体系 | D10-14 | 验证流程上线 |

**Phase 2: 能力建设（第8-21天）**

| 任务 | 时间 | 交付物 |
|-----|------|-------|
| Milvus 向量库部署 | D8-10 | 向量库就绪 |
| NebulaGraph 部署 | D10-12 | 图数据库就绪 |
| 本地 LLM 部署 | D10-14 | Qwen/GLM 服务就绪 |
| Embedding 模型测试 | D12-16 | 确定最优模型 |
| 实体抽取流程 | D14-18 | NER 流程上线 |
| 知识图谱构建 | D16-20 | 图谱初版 |
| 数据质量检查完善 | D18-21 | 质量体系完整 |

**Phase 3: 应用落地（第22-40天）**

| 任务 | 时间 | 交付物 |
|-----|------|-------|
| 预训练语料生成 | D22-28 | 语料数据集 |
| SFT 数据集构建 | D24-30 | SFT 数据集 |
| RLHF 数据标注流程 | D26-32 | 标注流程上线 |
| RAG 检索服务 | D28-34 | 检索 API |
| 智能问答系统 | D30-36 | 问答服务 |
| 数据标注系统 | D32-38 | 标注平台 |
| 集成测试 | D36-38 | 测试报告 |
| 上线部署 | D38-40 | 系统上线 |

### 13.2 关键里程碑

| 里程碑 | 时间节点 | 交付物 |
|-------|---------|-------|
| M1 | D5 | 基础设施就绪 |
| M2 | D14 | 三市场数据采集上线 |
| M3 | D21 | AI 能力就绪（LLM+向量+图谱） |
| M4 | D30 | 首批训练数据交付 |
| M5 | D36 | 核心应用上线 |
| M6 | D40 | 全功能上线 |

### 13.3 并行开发策略

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              并行开发安排                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  团队 A（基础设施）       团队 B（数据采集）       团队 C（AI能力）          │
│  ──────────────────       ──────────────────       ──────────────────        │
│  • K8s 部署               • A股采集                • LLM 部署               │
│  • MinIO 部署             • 港股采集               • Embedding 测试         │
│  • Dagster 部署           • 美股采集               • 向量库部署             │
│  • 监控告警               • 数据验证               • 图谱构建               │
│                                                                             │
│  团队 D（应用开发）                                                         │
│  ──────────────────                                                         │
│  • RAG 服务                                                                 │
│  • 问答系统                                                                 │
│  • 标注系统                                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 13.4 风险与应对

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 基础设施延期 | 阻塞后续 | 提前准备镜像，使用 Helm Chart 快速部署 |
| PDF解析效果不佳 | 数据质量差 | 双引擎并行，快速切换 |
| LLM 部署复杂 | AI能力延期 | 先用云端 API，本地部署并行推进 |
| 数据源变更 | 采集失败 | 预留适配时间，模块化设计 |
| 人员不足 | 进度延期 | 核心功能优先，MVP 先行 |

---

## 十四、技术栈总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              技术栈全景                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  数据覆盖                                                                   │
│  ├── A股: 上交所、深交所、北交所                                            │
│  ├── 港股: 香港联交所                                                       │
│  └── 美股: NYSE、NASDAQ                                                     │
│                                                                             │
│  存储层                                                                     │
│  ├── 对象存储: MinIO                                                        │
│  ├── 湖仓格式: Apache Iceberg                                               │
│  ├── 向量数据库: Milvus ✓国产                                               │
│  ├── 图数据库: NebulaGraph ✓国产                                            │
│  └── 元数据存储: PostgreSQL                                                 │
│                                                                             │
│  计算层                                                                     │
│  ├── 大批量处理: Spark on K8s (按需启动)                                    │
│  ├── 日常处理: DuckDB                                                       │
│  └── 任务调度: Dagster (数据质量感知)                                       │
│                                                                             │
│  AI 层                                                                      │
│  ├── PDF 解析: MinerU ✓国产 + Docling                                       │
│  ├── OCR: PaddleOCR ✓国产                                                   │
│  ├── Embedding: BGE/BCE ✓国产 (待测试确定)                                  │
│  │   └── 支持中英文双语向量化                                               │
│  └── LLM: Qwen/GLM/DeepSeek ✓国产 (本地) + 云端 API (补充)                  │
│      └── 支持中英文双语处理                                                 │
│                                                                             │
│  基础设施                                                                   │
│  ├── 容器编排: Kubernetes                                                   │
│  ├── 消息队列: Apache Kafka                                                 │
│  └── 监控: Prometheus + Grafana                                             │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  ✓ 全部支持私有化部署                                                       │
│  ✓ 核心组件国产化                                                           │
│  ✓ 数据不出网                                                               │
│  ✓ 支持中英文双语处理                                                       │
│  ✓ 覆盖 A股、港股、美股三大市场                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

*文档版本: 3.0*  
*更新日期: 2025年1月*
